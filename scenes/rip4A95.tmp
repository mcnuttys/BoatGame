[gd_scene load_steps=23 format=3 uid="uid://cu2uchf4tyink"]

[ext_resource type="Script" path="res://scripts/ripples_test.gd" id="1_8j0cr"]
[ext_resource type="Shader" path="res://scripts/water_simulation.gdshader" id="1_i1ufp"]
[ext_resource type="Shader" uid="uid://ly17ksihtdxt" path="res://scripts/ripples_test.tres" id="2_pf3cr"]
[ext_resource type="Shader" uid="uid://bio45diah7hff" path="res://scripts/water_simulation_buffer.tres" id="3_sjgb7"]
[ext_resource type="PackedScene" uid="uid://dnsra0lc63vua" path="res://scenes/boat_test.tscn" id="4_ryi1v"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_e1c7q"]
sky_horizon_color = Color(0.64625, 0.65575, 0.67075, 1)
ground_horizon_color = Color(0.64625, 0.65575, 0.67075, 1)

[sub_resource type="Sky" id="Sky_hohlg"]
sky_material = SubResource("ProceduralSkyMaterial_e1c7q")

[sub_resource type="Environment" id="Environment_3qtyy"]
background_mode = 2
sky = SubResource("Sky_hohlg")
tonemap_mode = 2
glow_enabled = true

[sub_resource type="ViewportTexture" id="ViewportTexture_2eqkq"]
viewport_path = NodePath("Simulation")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_qqcp6"]
resource_local_to_scene = true
shader = ExtResource("3_sjgb7")
shader_parameter/Texture2DParameter = SubResource("ViewportTexture_2eqkq")

[sub_resource type="ViewportTexture" id="ViewportTexture_acrqg"]
viewport_path = NodePath("SimulationCollision")

[sub_resource type="ViewportTexture" id="ViewportTexture_jtl5m"]
viewport_path = NodePath("SimulationBuffer")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_yirna"]
resource_local_to_scene = true
shader = ExtResource("1_i1ufp")
shader_parameter/phase = 0.2
shader_parameter/attenuation = 1.0
shader_parameter/deltaUV = 5.0
shader_parameter/simulationSize = 512.0
shader_parameter/sim_tex = SubResource("ViewportTexture_jtl5m")
shader_parameter/col_tex = SubResource("ViewportTexture_acrqg")

[sub_resource type="Environment" id="Environment_1yaki"]
background_mode = 1

[sub_resource type="ViewportTexture" id="ViewportTexture_hq1rg"]
viewport_path = NodePath("Simulation")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_bvim7"]
resource_local_to_scene = true
render_priority = 0
shader = ExtResource("2_pf3cr")
shader_parameter/amplitude = 0.1
shader_parameter/Simulation = SubResource("ViewportTexture_hq1rg")

[sub_resource type="PlaneMesh" id="PlaneMesh_old7f"]
material = SubResource("ShaderMaterial_bvim7")
size = Vector2(25.1, 25.1)
subdivide_width = 1024
subdivide_depth = 1024

[sub_resource type="SphereMesh" id="SphereMesh_k8ngu"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_2krk4"]
shading_mode = 0
albedo_color = Color(1, 0, 0, 1)

[sub_resource type="SphereMesh" id="SphereMesh_7djf5"]
material = SubResource("StandardMaterial3D_2krk4")

[sub_resource type="Animation" id="Animation_tpt1u"]
resource_name = "bounce"
loop_mode = 1
tracks/0/type = "position_3d"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = PackedFloat32Array(0, 1, 0, 1, 0, 0.5, 1, 0, 0, 0, 1, 1, 0, 1, 0)

[sub_resource type="AnimationLibrary" id="AnimationLibrary_gds1s"]
_data = {
"bounce": SubResource("Animation_tpt1u")
}

[node name="ripples_test" type="Node3D"]
script = ExtResource("1_8j0cr")
deltaUV = 1.3
simulationSize = 1024

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_3qtyy")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(-0.866023, -0.433016, 0.250001, 0, 0.499998, 0.866027, -0.500003, 0.749999, -0.43301, 0, 0, 0)
shadow_enabled = true

[node name="SimulationBuffer" type="SubViewport" parent="."]
render_target_clear_mode = 2
render_target_update_mode = 4

[node name="ColorRect" type="ColorRect" parent="SimulationBuffer"]
material = SubResource("ShaderMaterial_qqcp6")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="Simulation" type="SubViewport" parent="."]
render_target_clear_mode = 2
render_target_update_mode = 4

[node name="ColorRect" type="ColorRect" parent="Simulation"]
material = SubResource("ShaderMaterial_yirna")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="SimulationCollision" type="SubViewport" parent="."]
render_target_update_mode = 4

[node name="WaterCam" type="Camera3D" parent="SimulationCollision"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, -5, 0)
cull_mask = 524288
environment = SubResource("Environment_1yaki")
projection = 1
current = true
size = 25.1
near = 0.001
far = 5.0

[node name="CSGBox3D" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1.64673, 0)
size = Vector3(26, 5, 26)

[node name="CSGBox3D" type="CSGBox3D" parent="CSGBox3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.758709, 0)
operation = 2
size = Vector3(25, 4, 25)

[node name="Water" type="MeshInstance3D" parent="."]
mesh = SubResource("PlaneMesh_old7f")

[node name="Ball" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)

[node name="Mesh" type="MeshInstance3D" parent="Ball"]
mesh = SubResource("SphereMesh_k8ngu")

[node name="WaterCollider" type="MeshInstance3D" parent="Ball"]
layers = 524288
mesh = SubResource("SphereMesh_7djf5")
skeleton = NodePath("../Mesh")

[node name="AnimationPlayer" type="AnimationPlayer" parent="Ball"]
libraries = {
"": SubResource("AnimationLibrary_gds1s")
}
autoplay = "bounce"
speed_scale = 0.5

[node name="boat_test" parent="." instance=ExtResource("4_ryi1v")]
float_force = 4.0
